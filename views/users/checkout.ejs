<!DOCTYPE html>
<html class="no-js" lang="en">


<head>
    <meta charset="utf-8">
    <title>Shopee</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">

    <style>
        .error-box {
            position: fixed;
            left: 50%;
            transform: translateX(-50%);
            background-color: #000;
            /* Black background color */
            color: #fff;
            /* White text color */
            padding: 10px 20px;
            border-radius: 4px;
            z-index: 999;
            transition: top 0.5s ease-in-out;
        }

        .success-box {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            background-color: #000;
            /* Black background color */
            color: #fff;
            /* White text color */
            padding: 10px 20px;
            border-radius: 4px;
            z-index: 999;
            transition: top 0.5s ease-in-out;
        }

        .slide-in {
            top: 50px;
        }

        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center !important;
            /* Center horizontally */
            align-items: center !important;
            /* Center vertically */
            z-index: 9999;
        }


        #loader {
            margin-left: 45vw;
            margin-top: 45vh;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        #loading-screen {
            display: none;
        }
    </style>


    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/Userassets/imgs/theme/favicon.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Template CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <!-- Toastify.js -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js@1.9.4/toastify.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.15.5/dist/sweetalert2.min.css">
    <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/css/select2.min.css" rel="stylesheet" /> -->
    <!-- Add these links to the <head> section of your HTML -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropper/4.0.0/cropper.min.css">
    <link href="https://cdn.jsdelivr.net/npm/toastr@2.1.4/dist/css/toastr.min.css" rel="stylesheet">
    <!-- Vendor CSS -->
    <link rel="stylesheet" href="/Userassets/css/libs.bundle.css" />

    <!-- Main CSS -->
    <link rel="stylesheet" href="/Userassets/css/theme.bundle.css" />

    <script src="https://cdn.jsdelivr.net/npm/toastr@2.1.4/dist/toastr.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"
        integrity="sha512-AA1Bzp5Q0K1KanKKmvN/4d3IRKVlv9PYgwFPvm32nPO6QS8yH1HO7LbgB1pgiOxPtfeg5zEn2ba64MUcqJx6CA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/js/select2.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/toastify-js@1.9.4/toastify.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajaxy/1.6.1/scripts/jquery.ajaxy.min.js"></script>

    <script type="text/javascript">
        function disableBack() {
            window.history.forward();
        }
        setTimeout("disableBack()", 0);
        window.onunload = function () {
            null
        }
    </script>

</head>

<body>
    <!-- Quick view -->
    <div id="loading-screen">
        <div id="loader"></div>

    </div>

    <header class="header-area header-style-3 header-height-2">
        <div class="header-top header-top-ptb-1 d-none d-lg-block">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-xl-3 col-lg-4">
                        <div class="header-info">

                        </div>
                    </div>

                    <div class="col-xl-3 col-lg-4">

                    </div>
                </div>
            </div>
        </div>
        <div class="header-middle header-middle-ptb-1 d-none d-lg-block">
            <div class="container">
                <div class="header-wrap">
                    <div class="logo logo-width-1">
                        <a href="/"><img src="\stylesheets\assets\imgs\brands\brand-20.jpg" alt="logo"></a>
                    </div>
                    <div class="header-right">
                        <div class="search-style-2">

                        </div>
                        <div class="header-action-right">
                            <div class="header-action-2">


                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </header>

    <main class="main">
        <div class="container mt-5">
            <div class="row">
                <div class="col-lg-6">
                    <!-- IF ADDRESSES -->
                    <% if(addresses){ %>
                    <% addresses.addresses.forEach((item,index)=>{ %>

                    <div class="card mb-3">
                        <% if (item.addressType === 'temp') { %>
                        <div class="card-header d-flex gap-4">
                            <input type="radio" name="selectedAddress" value="<%= item.addressType %>"
                                id="address<%= index %>" style=" width: 16px;
                                        height: 16px;
                                        margin-top: 2px">
                            <h5 class="mb-0">Temporary Address</h5>
                        </div>
                        <% } else { %>
                        <div class="card-header d-flex gap-4">
                            <input type="radio" name="selectedAddress" value="<%= item.addressType %>"
                                id="address<%= index %>" style=" width: 16px;
                                        height: 16px;
                                        margin-top: 2px">
                            <h5 class="mb-0"><%= item.addressType.toUpperCase() %> Address</h5>
                        </div>

                        <% } %>
                        <div class="card-body">

                            <address>
                                <%= item.HouseNo %> <%= item.Street %><br>
                                <%= item.city %>, <%= item.State %> <%= item.pincode %> <%= item.Country %><br>
                            </address>
                            <p><%= item.district %></p>
                        </div>
                        <div class="card-footer d-flex justify-content-between">
                            <button class="btn" data-toggle="modal" data-target="#editAddressModal<%= index %>"
                                data-index="<%= index %>">Edit</button>
                            <button class="btn" type="button"
                                onclick="addressRemove('<%= item.addressType  %>')">Remove</button>
                        </div>
                    </div>

                    <div class="modal fade" id="editAddressModal<%= index %>" tabindex="-1" role="dialog"
                        aria-labelledby="editAddressModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered">
                            <!-- Add 'modal-lg' to make it large if needed -->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editAddressModalLabel">Edit Address</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form class="address-form" action="/cart/editAddress" method="post">
                                        <!-- Form fields for address details -->
                                        <div class="form-group mb-3">
                                            <label for="addressType">Address Type</label>
                                            <select class="form-control" id="editAddressType"
                                                value="<%= item.addressType %>" name="addressType" required>
                                                <option value="home"
                                                    <% if (item.addressType === 'home') { %>selected<% } %>>Home
                                                </option>
                                                <option value="work"
                                                    <% if (item.addressType === 'work') { %>selected<% } %>>Work
                                                </option>
                                                <option value="temp"
                                                    <% if (item.addressType === 'temp') { %>selected<% } %>>Temporary
                                                </option>
                                            </select>
                                            <span id="addressTypeError" class="text-danger"></span>
                                        </div>
                                        <div class="form-group mb-3">
                                            <label for="houseNo">House No</label>
                                            <input type="text" class="form-control editHouseNo" id="editHouseNo"
                                                required name="HouseNo" value="<%= item.HouseNo %>"
                                                placeholder="House Number">
                                            <span id="edithouseNoError" class="text-danger editHouseNo"></span>
                                        </div>
                                        <div class="form-group mb-3">
                                            <label for="street">Street</label>
                                            <input type="text" class="form-control editStreet" id="editStreet" required
                                                name="Street" value="<%= item.Street %>" placeholder="Street">
                                            <span id="editstreetError" class="text-danger streetError"></span>
                                        </div>
                                        <div class="form-group mb-3">
                                            <label for="landmark">Landmark</label>
                                            <input type="text" class="form-control" id="landmark" name="Landmark"
                                                placeholder="Landmark">

                                        </div>
                                        <div class="form-group mb-3">
                                            <label for="pincode">Pincode</label>
                                            <input type="number" class="form-control editPincode" id="editPincode"
                                                required name="pincode" value="<%= item.pincode %>"
                                                placeholder="Pincode">
                                            <span id="editpincodeError" class="text-danger pincodeError"></span>
                                        </div>
                                        <div class="form-group mb-3">
                                            <label for="city">City</label>
                                            <input type="text" class="form-control editCity" id="editCity" name="city"
                                                required value="<%= item.city %>" placeholder="City">
                                            <span id="editcityError" class="text-danger cityError"></span>
                                        </div>
                                        <div class="form-group mb-3">
                                            <label for="district">District</label>
                                            <input type="text" class="form-control cityError" id="editDistrict" required
                                                value="<%= item.district %>" name="district" placeholder="district">
                                            <span id="editdistrictError" class="text-danger districtError"></span>
                                        </div>
                                        <div class="form-group mb-3">
                                            <label for="state" class="mb-2 d-block">State</label>
                                            <select id="editState" class="form-control border districtError" required
                                                name="state">
                                                <option value="">Select A State</option>
                                                <option value="Andhra Pradesh"
                                                    <% if (item.State === 'Andhra Pradesh') { %>selected<% } %>>Andhra
                                                    Pradesh</option>
                                                <option value="Arunachal Pradesh"
                                                    <% if (item.State === 'Arunachal Pradesh') { %>selected<% } %>>
                                                    Arunachal Pradesh</option>
                                                <option value="Assam"
                                                    <% if (item.State === 'Assam') { %>selected<% } %>>Assam</option>
                                                <option value="Bihar"
                                                    <% if (item.State === 'Bihar') { %>selected<% } %>>Bihar</option>
                                                <option value="Chhattisgarh"
                                                    <% if (item.State === 'Chhattisgarh') { %>selected<% } %>>
                                                    Chhattisgarh</option>
                                                <option value="Goa" <% if (item.State === 'Goa') { %>selected<% } %>>Goa
                                                </option>
                                                <option value="Gujarat"
                                                    <% if (item.State === 'Gujarat') { %>selected<% } %>>Gujarat
                                                </option>
                                                <option value="Haryana"
                                                    <% if (item.State === 'Haryana') { %>selected<% } %>>Haryana
                                                </option>
                                                <option value="Himachal Pradesh"
                                                    <% if (item.State === 'Himachal Pradesh') { %>selected<% } %>>
                                                    Himachal Pradesh</option>
                                                <option value="Jharkhand"
                                                    <% if (item.State === 'Jharkhand') { %>selected<% } %>>Jharkhand
                                                </option>
                                                <option value="Karnataka"
                                                    <% if (item.State === 'Karnataka') { %>selected<% } %>>Karnataka
                                                </option>
                                                <option value="Kerala"
                                                    <% if (item.State === 'Kerala') { %>selected<% } %>>Kerala</option>
                                                <option value="Madhya Pradesh"
                                                    <% if (item.State === 'Madhya Pradesh') { %>selected<% } %>>Madhya
                                                    Pradesh</option>
                                                <option value="Maharashtra"
                                                    <% if (item.State === 'Maharashtra') { %>selected<% } %>>Maharashtra
                                                </option>
                                                <option value="Manipur"
                                                    <% if (item.State === 'Manipur') { %>selected<% } %>>Manipur
                                                </option>
                                                <option value="Meghalaya"
                                                    <% if (item.State === 'Meghalaya') { %>selected<% } %>>Meghalaya
                                                </option>
                                                <option value="Mizoram"
                                                    <% if (item.State === 'Mizoram') { %>selected<% } %>>Mizoram
                                                </option>
                                                <option value="Nagaland"
                                                    <% if (item.State === 'Nagaland') { %>selected<% } %>>Nagaland
                                                </option>
                                                <option value="Odisha"
                                                    <% if (item.State === 'Odisha') { %>selected<% } %>>Odisha</option>
                                                <option value="Punjab"
                                                    <% if (item.State === 'Punjab') { %>selected<% } %>>Punjab</option>
                                                <option value="Rajasthan"
                                                    <% if (item.State === 'Rajasthan') { %>selected<% } %>>Rajasthan
                                                </option>
                                                <option value="Sikkim"
                                                    <% if (item.State === 'Sikkim') { %>selected<% } %>>Sikkim</option>
                                                <option value="Tamil Nadu"
                                                    <% if (item.State === 'Tamil Nadu') { %>selected<% } %>>Tamil Nadu
                                                </option>
                                                <option value="Telangana"
                                                    <% if (item.State === 'Telangana') { %>selected<% } %>>Telangana
                                                </option>
                                                <option value="Tripura"
                                                    <% if (item.State === 'Tripura') { %>selected<% } %>>Tripura
                                                </option>
                                                <option value="Uttar Pradesh"
                                                    <% if (item.State === 'Uttar Pradesh') { %>selected<% } %>>Uttar
                                                    Pradesh</option>
                                                <option value="Uttarakhand"
                                                    <% if (item.State === 'Uttarakhand') { %>selected<% } %>>Uttarakhand
                                                </option>
                                                <option value="West Bengal"
                                                    <% if (item.State === 'West Bengal') { %>selected<% } %>>West Bengal
                                                </option>
                                                <!-- Add more states as needed -->
                                            </select>
                                            <span id="editstateError" class="text-danger stateError"></span>
                                        </div>
                                        <div class="form-group mb-3">
                                            <label for="country">Country</label>
                                            <input type="text" required class="form-control stateError" id="editCountry"
                                                value="<%= item.Country %>" name="Country" placeholder="Country">
                                            <span id="editcountryError" class="text-danger countryError"></span>
                                        </div>
                                        <!-- Other address fields here... -->

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="submit" class="btn" style="background-color: #19B8A2;">Save
                                        Changes</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <% }) %>
                    <% if(addresses.addresses.length<3){ %>
                    <div class="row">
                        <div class="col-12">
                            <div class="border border-dotted border-success p-0">
                                <button class="btn btn-success w-100 h-100" data-toggle="modal"
                                    data-target="#addressModal">
                                    Add Address
                                </button>
                            </div>
                        </div>
                    </div>
                    <% } %>

                    <% }else{ %>

                    <h2>Shipping Address</h2>
                    <form id="addressForm">

                        <div class="form-group mb-3">
                            <label for="addressType">Address Type</label>
                            <select class="form-control" id="addressType" name="addressType">
                                <option value="home">Home</option>
                                <option value="work">Work</option>
                                <option value="temp">Temporary</option>
                            </select>
                            <span id="addressTypeError" class="text-danger"></span>
                        </div>
                        <div class="form-group mb-3">
                            <label for="houseNo">House No</label>
                            <input type="text" class="form-control" id="houseNo" placeholder="House Number">
                            <span id="houseNoError" class="text-danger"></span>
                        </div>
                        <div class="form-group mb-3">
                            <label for="street">Street</label>
                            <input type="text" class="form-control" id="street" placeholder="Street">
                            <span id="streetError" class="text-danger"></span>
                        </div>
                        <div class="form-group mb-3">
                            <label for="landmark">Landmark</label>
                            <input type="text" class="form-control" id="landmark" placeholder="Landmark">

                        </div>
                        <div class="form-group mb-3">
                            <label for="pincode">Pincode</label>
                            <input type="number" class="form-control" id="pincode" placeholder="Pincode">
                            <span id="pincodeError" class="text-danger"></span>
                        </div>
                        <div class="form-group mb-3">
                            <label for="city">City</label>
                            <input type="text" class="form-control" id="city" placeholder="City">
                            <span id="cityError" class="text-danger"></span>
                        </div>
                        <div class="form-group mb-3">
                            <label for="district">District</label>
                            <input type="text" class="form-control" id="district" placeholder="district">
                            <span id="districtError" class="text-danger"></span>
                        </div>
                        <div class="form-group mb-3">
                            <label for="state" class="mb-2 d-block">State</label>
                            <select id="state" class="form-control border" required name="state">
                                <option value="">Select A State</option>
                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                <option value="Assam">Assam</option>
                                <option value="Bihar">Bihar</option>
                                <option value="Chhattisgarh">Chhattisgarh</option>
                                <option value="Goa">Goa</option>
                                <option value="Gujarat">Gujarat</option>
                                <option value="Haryana">Haryana</option>
                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                <option value="Jharkhand">Jharkhand</option>
                                <option value="Karnataka">Karnataka</option>
                                <option value="Kerala">Kerala</option>
                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                <option value="Maharashtra">Maharashtra</option>
                                <option value="Manipur">Manipur</option>
                                <option value="Meghalaya">Meghalaya</option>
                                <option value="Mizoram">Mizoram</option>
                                <option value="Nagaland">Nagaland</option>
                                <option value="Odisha">Odisha</option>
                                <option value="Punjab">Punjab</option>
                                <option value="Rajasthan">Rajasthan</option>
                                <option value="Sikkim">Sikkim</option>
                                <option value="Tamil Nadu">Tamil Nadu</option>
                                <option value="Telangana">Telangana</option>
                                <option value="Tripura">Tripura</option>
                                <option value="Uttar Pradesh">Uttar Pradesh</option>
                                <option value="Uttarakhand">Uttarakhand</option>
                                <option value="West Bengal">West Bengal</option>
                                <!-- Add more states as needed -->
                            </select>
                            <span id="stateError" class="text-danger"></span>

                        </div>
                        <div class="form-group mb-3">
                            <label for="country">Country</label>
                            <input type="text" class="form-control" id="country" placeholder="Country">
                            <span id="countryError" class="text-danger"></span>
                        </div>
                        <div>
                            <button type="submit" id="saveAddress" class="btn" style="background-color: #19B8A2;">Save
                                Address</button>
                        </div>
                    </form>


                    <% } %>
                </div>

                <div class="col-md-6">

                    <div class="card mb-4">
                        <div class="card-header py-3">
                            <h5 class="mb-0 text-font">Items to Buy: <%= itemCount %></h5>
                        </div>
                        <div class="card-body">
                            <% selectedItems.forEach(item => { %>
                            <div class="row mt-3">
                                <input type="text" hidden value="<%= item.productId %>" name="produtId"
                                    class="productId">
                                <div class="col-md-4">
                                    <img src="<%= item.image %>" class="rounded-3" style="width: 100px;"
                                        alt="<%= item.name %>" />
                                </div>
                                <div class="col-md-6 ms-3">
                                    <span>INR <%= item.price %> </span>
                                    <p class="mb-0 text-descriptions"><%= item.name %> </p>
                                    <p class="text-descriptions mt-0">Qty:<span
                                            class="text-descriptions fw-bold"><%= item.quantity %></span>
                                    </p>
                                </div>
                            </div>
                            <% }) %>

                            <div class="card-footer mt-4">
                                <ul class="list-group list-group-flush">
                                    <li
                                        class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0 text-muted">
                                        Subtotal
                                        <span>INR <%= billTotal %></span>
                                    </li>
                                    <li
                                        class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0 text-muted">
                                        Discount
                                        <span>
                                            <% if(discountPrice &&  discountedTotal){ %>
                                            <%= discountPrice %>
                                            <% }else{ %>
                                            0
                                            <% } %>
                                        </span>
                                    </li>
                                    <li
                                        class="list-group-item d-flex justify-content-between align-items-center px-0 fw-bold text-uppercase">
                                        Total to pay
                                        <span>INR <% if(discountPrice &&  discountedTotal){ %>
                                            <%= discountedTotal %>
                                            <% }else{ %>
                                            <%= billTotal %>
                                            <% } %> </span>
                                    </li>
                                </ul>
                            </div>


                        </div>

                    </div>

                    <div class="modal fade" id="couponModal" tabindex="-1" role="dialog"
                        aria-labelledby="couponModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="couponModalLabel">Coupon Details</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>

                                <% if (coupon && coupon.length > 0) { %>
                                <% coupon.forEach(element => { %>
                                <div class="modal-body">
                                    <p>Coupon code: <span class="couponCode"
                                            style="color: #19B8A2;"><%= element.couponCode %></span>
                                    </p>
                                    <p>Discount: <%= element.minDiscountPercentage %>%</p>
                                    <p style="color: #ff0000;">minimum purchase: <%= element.minPurchase %></p>
                                    <p>Description: <%= element.discription %></p>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary"
                                        onclick="copyCouponCode('<%= element.couponCode %>')">Copy
                                        Coupon
                                        Code</button>
                                </div>

                                <% }) %>
                                <% } else { %>
                                <p class="text-center">No coupons available</p>
                                <% } %>%

                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Apply Coupon Form -->
                        <div class="card mb-4">
                            <div class="card-header">
                                Enter Coupon Code
                            </div>
                            <div class="card-body">
                                <form id="applyCouponForm">
                                    <div class="form-group">
                                        <label for="userCouponCode">Coupon Code</label>
                                        <input type="text" class="form-control" id="userCouponCode"
                                            placeholder="Enter coupon code" value="">

                                        <p class="mt-5 text-success"></p>

                                    </div>
                                    <button type="button" class="btn btn-primary" onclick="applyCoupon()">Apply
                                        Coupon</button>
                                </form>

                            </div>
                        </div>


                        <!-- Display Coupon Details -->
                        <div class="card-body">
                            <a>
                                <p style="color: rgb(189, 70, 70);"></p>
                                <p data-toggle="modal" data-target="#couponModal" style="font-weight: 700;">
                                    Show Coupons <i class="fa-solid fa-ticket" style="color: #1ed01b;"></i>
                                </p>
                            </a>
                        </div>
                    </div>
                    <div class="card mb-4">
                        <div class="card-header">
                            Payment Methods
                        </div>
                        <div class="card-body">
                            <form id="paymentForm">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="paymentOption"
                                        id="cashOnDelivery" value="cashOnDelivery">
                                    <label class="form-check-label" for="cashOnDelivery">
                                        Cash on Delivery
                                    </label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="paymentOption" id="Razorpay"
                                        value="Razorpay">
                                    <label class="form-check-label" for="cashOnDelivery">
                                        Online Payment
                                    </label>
                                <!-- </div>
                                <% if (userDetail.WalletData) { %>
                                <div class="form-check">
                                    <% if (userDetail.WalletData.balance < billTotal) { %>
                                    <input class="form-check-input" type="radio" style="border-color: black;"
                                        name="paymentOption" id="Wallet" value="Wallet" disabled>
                                    <label class="form-check-label" for="cashOnDelivery">
                                        Wallet (Insufficient funds)
                                    </label>
                                    <p class="text-danger" style="font-size: smaller;">Wallet balance is
                                        insufficient. Please choose another payment method.</p>
                                    <% } else { %>
                                    <!-- <input class="form-check-input" type="radio" style="border-color: black;"
                                        name="paymentOption" id="Wallet" value="Wallet"> -->
                                    <!-- <label class="form-check-label" for="cashOnDelivery">
                                        Wallett
                                    </label> -->
                                    <% } %>
                                </div>
                                <% } %> 



                            </form>
                        </div>
                    </div>
                </div>

                <div class="row justify-content-center" style="padding-left: 300px;">
                    <button type="button" id="proceedButton" class="btn w-25" style="background-color: #19B8A2;">
                        Proceed to Payment</button>

                </div>


            </div>


        </div>
        </div>


    </main>
    <footer class="border-top py-5 mt-4  ">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center flex-column flex-lg-row">
                <div>
                    <ul class="list-unstyled">
                        <li class="d-inline-block me-1"><a class="text-decoration-none text-dark-hover transition-all"
                                href="#"><i class="ri-instagram-fill"></i></a></li>
                        <li class="d-inline-block me-1"><a class="text-decoration-none text-dark-hover transition-all"
                                href="#"><i class="ri-facebook-fill"></i></a></li>
                        <li class="d-inline-block me-1"><a class="text-decoration-none text-dark-hover transition-all"
                                href="#"><i class="ri-twitter-fill"></i></a></li>
                        <li class="d-inline-block me-1"><a class="text-decoration-none text-dark-hover transition-all"
                                href="#"><i class="ri-snapchat-fill"></i></a></li>
                    </ul>
                </div>
                <div class="d-flex align-items-center justify-content-end flex-column flex-lg-row">
                    <div class="images"> <img class="footer-bank-ssl"
                            src="https://constant.myntassets.com/checkout/assets/img/footer-bank-ssl.png" width="70"
                            height="37"> <img class="footer-bank-visa"
                            src="https://constant.myntassets.com/checkout/assets/img/footer-bank-visa.png" width="60"
                            height="37"> <img class="footer-bank-mc"
                            src="https://constant.myntassets.com/checkout/assets/img/footer-bank-mc.png" width="60"
                            height="37"> <img class="footer-bank-ae"
                            src="https://constant.myntassets.com/checkout/assets/img/footer-bank-ae.png" width="60"
                            height="37"> <img class="footer-bank-dc"
                            src="https://constant.myntassets.com/checkout/assets/img/footer-bank-dc.png" width="60"
                            height="37"> <img class="footer-bank-nb"
                            src="https://constant.myntassets.com/checkout/assets/img/footer-bank-nb.png" width="60"
                            height="37"> <img class="footer-bank-cod"
                            src="https://constant.myntassets.com/checkout/assets/img/footer-bank-cod.png" width="60"
                            height="37"> <img class="footer-bank-rupay"
                            src="https://constant.myntassets.com/checkout/assets/img/footer-bank-rupay.png" width="60"
                            height="37"> <img class="footer-bank-paypal"
                            src="https://constant.myntassets.com/checkout/assets/img/footer-bank-paypal.png" width="60"
                            height="37"> <img class="footer-bank-bhim"
                            src="https://constant.myntassets.com/checkout/assets/img/footer-bank-bhim.png" width="60"
                            height="37"> </div>
                </div>
            </div>
        </div>
    </footer>
    <% if(err!=='' ){ %>

    <% } %>

    <!-- MODALS -->
    <div class="modal fade" id="addressModal" tabindex="-1" role="dialog" aria-labelledby="addressModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addressModalLabel">Add Address</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addressForm">
                        <!-- Form fields for address details -->
                        <div class="form-group mb-3">
                            <label for="addressType">Address Type</label>
                            <select class="form-control" id="addressType" name="addressType">
                                <option value="home" <%= selectedAddressTypes.includes('home') ? 'disabled' : '' %>>Home
                                </option>
                                <option value="work" <%= selectedAddressTypes.includes('work') ? 'disabled' : '' %>>Work
                                </option>
                                <option value="temp" <%= selectedAddressTypes.includes('temp') ? 'disabled' : '' %>>
                                    Temporary</option>
                            </select>
                            <span id="addressTypeError" class="text-danger"></span>
                        </div>
                        <div class="form-group mb-3">
                            <label for="houseNo">House No</label>
                            <input type="text" class="form-control" id="houseNo" placeholder="House Number">
                            <span id="houseNoError" class="text-danger"></span>
                        </div>
                        <div class="form-group mb-3">
                            <label for="street">Street</label>
                            <input type="text" class="form-control" id="street" placeholder="Street">
                            <span id="streetError" class="text-danger"></span>
                        </div>
                        <div class="form-group mb-3">
                            <label for="landmark">Landmark</label>
                            <input type="text" class="form-control" id="landmark" placeholder="Landmark">

                        </div>
                        <div class="form-group mb-3">
                            <label for="pincode">Pincode</label>
                            <input type="number" class="form-control" id="pincode" placeholder="Pincode">
                            <span id="pincodeError" class="text-danger"></span>
                        </div>
                        <div class="form-group mb-3">
                            <label for="city">City</label>
                            <input type="text" class="form-control" id="city" placeholder="City">
                            <span id="cityError" class="text-danger"></span>
                        </div>
                        <div class="form-group mb-3">
                            <label for="district">District</label>
                            <input type="text" class="form-control" id="district" placeholder="district">
                            <span id="districtError" class="text-danger"></span>
                        </div>
                        <div class="form-group mb-3">
                            <label for="state" class="mb-2 d-block">State</label>
                            <select id="state" class="form-control border" required name="state">
                                <option value="">Select A State</option>
                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                <option value="Assam">Assam</option>
                                <option value="Bihar">Bihar</option>
                                <option value="Chhattisgarh">Chhattisgarh</option>
                                <option value="Goa">Goa</option>
                                <option value="Gujarat">Gujarat</option>
                                <option value="Haryana">Haryana</option>
                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                <option value="Jharkhand">Jharkhand</option>
                                <option value="Karnataka">Karnataka</option>
                                <option value="Kerala">Kerala</option>
                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                <option value="Maharashtra">Maharashtra</option>
                                <option value="Manipur">Manipur</option>
                                <option value="Meghalaya">Meghalaya</option>
                                <option value="Mizoram">Mizoram</option>
                                <option value="Nagaland">Nagaland</option>
                                <option value="Odisha">Odisha</option>
                                <option value="Punjab">Punjab</option>
                                <option value="Rajasthan">Rajasthan</option>
                                <option value="Sikkim">Sikkim</option>
                                <option value="Tamil Nadu">Tamil Nadu</option>
                                <option value="Telangana">Telangana</option>
                                <option value="Tripura">Tripura</option>
                                <option value="Uttar Pradesh">Uttar Pradesh</option>
                                <option value="Uttarakhand">Uttarakhand</option>
                                <option value="West Bengal">West Bengal</option>
                                <!-- Add more states as needed -->
                            </select>
                            <span id="stateError" class="text-danger"></span>

                        </div>
                        <div class="form-group mb-3">
                            <label for="country">Country</label>
                            <input type="text" class="form-control" id="country" placeholder="Country">
                            <span id="countryError" class="text-danger"></span>
                        </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" id="saveAddress" class="btn" style="background-color: #19B8A2;">Save
                        Address</button>
                </div>
                </form>
            </div>
        </div>
    </div>



    <!-- Preloader Start -->
    <div id="loading-screen">
        <div id="loader"></div>
    </div>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>


    <script>
        $(document).ready(function () {
            const form2 = document.getElementById('addressForm')

            document.getElementById('addressForm').addEventListener('submit', (e) => {

                e.preventDefault();
                if (validateForm()) {
                    saveAddress();
                }
            });

            function validateForm() {
                var valid = true;
                var addressType = $('#addressType').val();
                var houseNo = $('#houseNo').val().trim();
                var street = $('#street').val().trim();
                var pincode = $('#pincode').val();
                var city = $('#city').val().trim();
                var district = $('#district').val().trim();
                var state = $('#state').val();
                var country = $('#country').val().trim();

                // Clear previous errors
                clearErrors();

                // Validation rules
                if (!addressType) {
                    valid = false;
                    $('#addressTypeError').text('Type of Address is required');
                }
                if (!houseNo) {
                    valid = false;
                    $('#houseNoError').text('House No is required.');
                }
                if (!street) {
                    valid = false;
                    $('#streetError').text('Street is required.');
                }
                if (!pincode || !/^\d{6}$/.test(pincode)) {
                    valid = false;
                    $('#pincodeError').text('Pincode must be a 6-digit number.');
                }
                if (!city || !/^[A-Za-z\s]+$/.test(city)) {
                    valid = false;
                    $('#cityError').text('City is required and should contain only text.');
                }
                if (!state || !/^[A-Za-z\s]+$/.test(city)) {
                    valid = false;
                    $('#stateError').text('State is required.');
                }
                if (!district || !/^[A-Za-z\s]+$/.test(city)) {
                    valid = false;
                    $('#districtError').text('District is required.');
                }
                if (!country || /\d/.test(country)) {
                    valid = false;
                    $('#countryError').text('Country is required and should not contain numbers.');
                }

                return valid;
            }

            function clearErrors() {
                $('#addressTypeError').text('');
                $('#houseNoError').text('');
                $('#streetError').text('');
                $('#pincodeError').text('');
                $('#cityError').text('');
                $('#districtError').text('');
                $('#stateError').text('');
                $('#countryError').text('');
            }

            function saveAddress() {
                var addressData = {
                    addressType: $('#addressType').val(),
                    houseNo: $('#houseNo').val(),
                    street: $('#street').val(),
                    landmark: $('#landmark').val(),
                    pincode: $('#pincode').val(),
                    city: $('#city').val(),
                    district: $('#district').val(),
                    state: $('#state').val(),
                    country: $('#country').val()
                };

                console.log(addressData)
                console.log('llllllllllllllllllllllllllllllll');
                fetch('/profile/addAddress', {
                        method: 'POST',
                        body: JSON.stringify(addressData),
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then((response) => {
                        return response.json();
                    })
                    .then((data) => {
                        if (data.success) {
                            Swal.fire({
                                icon: 'success',
                                title: 'Success',
                                text: 'Address Saved Successfully',
                            });
                            $('#').modal('hide');
                            window.location.reload();
                        } else {
                            Swal.fire({
                                icon: 'success',
                                title: 'Success',
                                text: data.message,
                            });
                            window.location.reload();
                        }
                    })
                    .catch(function (error) {
                        console.error(error);
                        alert('An error occurred while saving the address.');
                    });
            }
        });




        function addressRemove(addressType) {

            console.log(addressType);
            fetch(`/profile/deleteAddress ? addressType = ${addressType}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },

                })
                .then((response) => {
                    if (response.ok) {

                        console.log('Address deleted successfully.');
                        Swal.fire('sucess', 'item deleted sucessfully')
                    } else {
                        // Handle the error and display an error message
                        console.error('Error deleting address:', response.statusText);
                    }
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }


        // document.getElementById().addEventListener("submit", function (event) {
        //     if (event.target.classList.contains("address-form")) {
        //         event.preventDefault();

        //         const form = event.target;
        //         const addressTypeError = form.querySelector("#addressTypeError");
        //         const houseNoError = form.querySelector("#edithouseNoError");
        //         const streetError = form.querySelector("#editstreetError");
        //         const pincodeError = form.querySelector("#editpincodeError");
        //         const cityError = form.querySelector("#editcityError");
        //         const districtError = form.querySelector("#editdistrictError");
        //         const stateError = form.querySelector("#editstateError");
        //         const countryError = form.querySelector("#editcountryError");

        //         const addressType = form.querySelector("#editAddressType").value;
        //         const houseNo = form.querySelector("#editHouseNo").value.trim();
        //         const street = form.querySelector("#editStreet").value.trim();
        //         const pincode = form.querySelector("#editPincode").value;
        //         const city = form.querySelector("#editCity").value.trim();
        //         const district = form.querySelector("#editDistrict").value.trim();
        //         const state = form.querySelector("#editState").value;
        //         const country = form.querySelector("#editCountry").value.trim();

        //         let valid = true; // Assuming validity by default

        //         if (!addressType) {
        //             valid = false;
        //             $('#addressTypeError').text('Type of Address is required');
        //         }

        //         if (!houseNo) {
        //             valid = false;
        //             $('#houseNoError').text('House No is required.');
        //         }

        //         if (!street) {
        //             valid = false;
        //             $('#streetError').text('Street is required.');
        //         }

        //         if (!pincode || !/^\d{6}$/.test(pincode)) {
        //             valid = false;
        //             $('#pincodeError').text('Pincode must be a 6-digit number.');
        //         }

        //         if (!city || !/^[A-Za-z\s]+$/.test(city)) {
        //             valid = false;
        //             $('#cityError').text('City is required and should contain only text.');
        //         }

        //         if (!state) {
        //             valid = false;
        //             $('#stateError').text('State is required.');
        //         }

        //         if (!district) {
        //             valid = false;
        //             $('#districtError').text('District is Required');
        //         }

        //         if (!country || /\d/.test(country)) {
        //             valid = false;
        //             $('#countryError').text('Country is required and should not contain numbers.');
        //         }

        //     }
        // });


        //CASH ON DELEIVERY 
        const billTotalElement = document.querySelector(
            '.card-footer span:last-child'); // Assuming this selects the correct span
        const billTotalText = billTotalElement.textContent;
        const billTotal = parseFloat(billTotalText.split(' ')[1]);



        if (billTotal === 0) {
            proceedButton.setAttribute('disabled', true);

        }



        proceedButton.addEventListener("click", () => {

            const selectedAddressType = document.querySelector('input[name="selectedAddress"]:checked').value;

            const paymentOption = document.querySelector('input[name="paymentOption"]:checked').value;



            const data = {
                addressType: selectedAddressType,
                paymentOption: paymentOption,

            };



            fetch("/cart/checkout", {
                    method: "POST", // Use the appropriate HTTP method
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(data),
                })
                .then((response) => response.json())
                .then((result) => {
                    if (result.success) {

                        console.log("Payment Option:", paymentOption); // Debugging line
                        console.log(result);
                        if (paymentOption === 'cashOnDelivery' || paymentOption === 'Wallet') {

                            Swal.fire("Success", "Cash on Delivery payment processed.", "success");
                            location.href = `/cart/order-confirmation/${result.orderId}`
                        } else if (paymentOption === 'Razorpay') {
                            console.log("Razorpay Payment Option"); // Debugging line
                            initiateRazorpayPayment(result.order.orderId, result.amount, result);
                        } else {

                        }
                    } else {
                        Swal.fire("Error", `An error occurred: ${ result.error }`, "error")
                    }

                })

                .catch((error) => {
                    // loadingScreen.style.display = "none"
                    console.error("Error:", error);
                });
        });


        function initiateRazorpayPayment(orderId, amount, res) {
            console.log(res)
            console.log(orderId)
            var options = {
                key: "" + res.key_id + "",
                amount: amount,
                currency: 'INR',
                name: 'Shopee',
                description: 'Payment for your order',
                order_id: res.order.orderId,
                handler: function (response) {
                    console.log(response)
                    const paymentData = {
                        razorpay_payment_id: response.razorpay_payment_id,
                        razorpay_order_id: orderId,
                        razorpay_signature: response.razorpay_signature,

                    };
                    alert('sdf')
                    fetch('/cart/verify-payment', {
                            method: 'POST',
                            body: JSON.stringify(paymentData),
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                        .then((response) => response.json())
                        .then((data) => {

                            if (data.success) {
                                console.log(data);
                                location.href =
                                    `/cart/order-confirmation/${data.updatedOrder._id}`
                            } else {
                                alert('Payment failed hfhguh');
                                location.href = '/cart/payment-failed'
                            }
                        })
                        .catch((error) => {

                            console.error(error);
                        });
                },
                prefill: {
                    "contact": "" + res.contact + "",
                    "name": "" + res.name + "",
                    "email": "" + res.email + ""
                },
                notes: {
                    address: "" + res.address + "",
                },
                theme: {
                    color: '#19B8A2',
                },
            };

            var rzp = new Razorpay(options);
            rzp.on('payment.failed', function (response) {
                alert("Payment Failed");
            });

            rzp.open();
        }
    </script>
    </script>
    <!-- Vendor JS-->
    <script src="/assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="/assets/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="/assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
    <script src="/assets/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/plugins/slick.js"></script>
    <script src="/assets/js/plugins/jquery.syotimer.min.js"></script>
    <script src="/assets/js/plugins/wow.js"></script>
    <script src="/assets/js/plugins/jquery-ui.js"></script>
    <script src="/assets/js/plugins/perfect-scrollbar.js"></script>
    <script src="/assets/js/plugins/magnific-popup.js"></script>
    <script src="/assets/js/plugins/select2.min.js"></script>
    <script src="/assets/js/plugins/waypoints.js"></script>
    <script src="/assets/js/plugins/counterup.js"></script>
    <script src="/assets/js/plugins/jquery.countdown.min.js"></script>
    <script src="/assets/js/plugins/images-loaded.js"></script>
    <script src="/assets/js/plugins/isotope.js"></script>
    <script src="/assets/js/plugins/scrollup.js"></script>
    <script src="/assets/js/plugins/jquery.vticker-min.js"></script>
    <script src="/assets/js/plugins/jquery.theia.sticky.js"></script>
    <script src="/assets/js/plugins/jquery.elevatezoom.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Template  JS -->
    <script src="/assets/js/shop.js"></script>
    <script src="/assets/js/main.js"></script>

</body>

</html>