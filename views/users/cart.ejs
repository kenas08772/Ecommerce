<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <title>Shopee</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/Userassets/imgs/theme/favicon.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Template CSS -->
    <link rel="stylesheet" href="/Userassets/css/main.css?v=3.4">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="shortcut icon" type="image/x-icon" href="assets/imgs/theme/favicon.svg">
    <!-- Template CSS -->
    <link rel="stylesheet" href="assets/css/main.css?v=3.4">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajaxy/1.6.1/scripts/jquery.ajaxy.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js@1.9.4/toastify.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.15.5/dist/sweetalert2.min.css">
    <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/css/select2.min.css" rel="stylesheet" /> -->
    <!-- Add these links to the <head> section of your HTML -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropper/4.0.0/cropper.min.css">
    <link href="https://cdn.jsdelivr.net/npm/toastr@2.1.4/dist/css/toastr.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/toastr@2.1.4/dist/toastr.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"
        integrity="sha512-AA1Bzp5Q0K1KanKKmvN/4d3IRKVlv9PYgwFPvm32nPO6QS8yH1HO7LbgB1pgiOxPtfeg5zEn2ba64MUcqJx6CA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/js/select2.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/toastify-js@1.9.4/toastify.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajaxy/1.6.1/scripts/jquery.ajaxy.min.js"></script>


</head>

<body>
    <!-- Quick view -->

    <header class="header-area header-style-3 header-height-2">
        <div class="header-top header-top-ptb-1 d-none d-lg-block">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-xl-3 col-lg-4">
                        <div class="header-info">
                            <ul>
                                <li><i class="fi-rs-smartphone"></i> <a href="#">+917012917688</a></li>
                            </ul>
                        </div>
                    </div>
                   
                    <div class="col-xl-3 col-lg-4">
                        <div class="header-info header-info-right">
                            <ul>
                                <% if(user){  %>
                                <li><i class="fi-rs-user"></i><a href="userProfile">Profile</a></li>
                                <li><i class="fi-rs-user"></i><a href="/logout">Logout</a></li>
                                <% } else {  %>
                                <li><i class="fi-rs-user"></i><a href="/login">Log In / Sign Up</a></li>
                                <% } %>

                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-middle header-middle-ptb-1 d-none d-lg-block">
            <div class="container">
                <div class="header-wrap">
                    <div class="logo logo-width-1">
                        <a href="/home"><img src="/Userassets/imgs/banner/brand-20.jpg" alt="logo"></a>
                    </div>
                    <div class="header-right">
                        <div class="container mt-3">
                            <form class="form-inline">
                               
                            </form>
                        </div>

                        <div class="header-action-right">
                            <div class="header-action-2">
                                <div class="header-action-icon-2">
                                    <a href="/cart/whishlistGet">
                                        <img class="svgInject" alt="Evara"
                                            src="assets/imgs/theme/icons/icon-heart.svg">
                                        <!-- <span class="pro-count blue">4</span> -->
                                    </a>
                                </div>
                                <div class="header-action-icon-2">
                                    <a class="mini-cart-icon" href="/cart">
                                        <img alt="Evara" src="assets/imgs/theme/icons/icon-cart.svg">
                                        <!-- <span class="pro-count blue">2</span> -->
                                    </a>
                                    <!-- <div class="cart-dropdown-wrap cart-dropdown-hm2">
                                        <ul>
                                            <li>
                                                <div class="shopping-cart-img">
                                                    <a href="#"><img alt="Evara" src="/Userassets/imgs/shop/thumbnail-3.jpg"></a>
                                                </div>
                                                <div class="shopping-cart-title">
                                                    <h4><a href="shop-product-right.html">Daisy Casual Bag</a></h4>
                                                    <h4><span>1 × </span>$800.00</h4>
                                                </div>
                                                <div class="shopping-cart-delete">
                                                    <a href="#"><i class="fi-rs-cross-small"></i></a>
                                                </div>
                                            </li>
                                            <li>
                                                <div class="shopping-cart-img">
                                                    <a href="shop-product-right.html"><img alt="Evara" src="/Userassets/imgs/shop/thumbnail-2.jpg"></a>
                                                </div>
                                                <div class="shopping-cart-title">
                                                    <h4><a href="shop-product-right.html">Corduroy Shirts</a></h4>
                                                    <h4><span>1 × </span>$3200.00</h4>
                                                </div>
                                                <div class="shopping-cart-delete">
                                                    <a href="#"><i class="fi-rs-cross-small"></i></a>
                                                </div>
                                            </li>
                                        </ul>
                                        <div class="shopping-cart-footer">
                                            <div class="shopping-cart-total">
                                                <h4>Total <span>$4000.00</span></h4>
                                            </div>
                                            <div class="shopping-cart-button">
                                                <a href="shop-cart.html" class="outline">View cart</a>
                                                <a href="shop-checkout.html">Checkout</a>
                                            </div>
                                        </div>
                                    </div> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-bottom header-bottom-bg-color sticky-bar">
            <div class="container">
                <div class="header-wrap header-space-between position-relative  main-nav">
                    <div class="logo logo-width-1 d-block d-lg-none">
                        <a href="/mainpage"><img src="/images/F.jpg" alt="logo"></a>
                    </div>
                    <div class="header-nav d-none d-lg-flex">
                        <div class="main-categori-wrap d-none d-lg-block">
                           
                            <div class="categori-dropdown-wrap categori-dropdown-active-large">
                                <ul>
                                    <!-- <li class="has-children">
                                        <a href="shop-grid-right.html"><i class="evara-font-dress"></i>Women's Clothing</a>
                                        <div class="dropdown-menu">
                                            <ul class="mega-menu d-lg-flex">
                                                <li class="mega-menu-col col-lg-7">
                                                    <ul class="d-lg-flex">
                                                        <li class="mega-menu-col col-lg-6">
                                                            <ul>
                                                                <li><span class="submenu-title">Hot & Trending</span></li>
                                                                <li><a class="dropdown-item nav-link nav_item" href="#">Dresses</a></li>
                                                                <li><a class="dropdown-item nav-link nav_item" href="#">Blouses & Shirts</a></li>
                                                                <li><a class="dropdown-item nav-link nav_item" href="#">Hoodies & Sweatshirts</a></li>
                                                                <li><a class="dropdown-item nav-link nav_item" href="#">Women's Sets</a></li>
                                                                <li><a class="dropdown-item nav-link nav_item" href="#">Suits & Blazers</a></li>
                                                                <li><a class="dropdown-item nav-link nav_item" href="#">Bodysuits</a></li>
                                                                <li><a class="dropdown-item nav-link nav_item" href="#">Tanks & Camis</a></li>
                                                                <li><a class="dropdown-item nav-link nav_item" href="#">Coats & Jackets</a></li>
                                                            </ul>
                                                        </li>
                                                    </ul>
                                                </li>
                                                <li class="mega-menu-col col-lg-5">
                                                    <div class="header-banner2">
                                                        <img src="/Userassets/imgs/banner/menu-banner-2.jpg" alt="menu_banner1">
                                                        <div class="banne_info">
                                                            <h6>10% Off</h6>
                                                            <h4>New Arrival</h4>
                                                            <a href="#">Shop now</a>
                                                        </div>
                                                    </div>
                                                    <div class="header-banner2">
                                                        <img src="/Userassets/imgs/banner/menu-banner-3.jpg" alt="menu_banner2">
                                                        <div class="banne_info">
                                                            <h6>15% Off</h6>
                                                            <h4>Hot Deals</h4>
                                                            <a href="#">Shop now</a>
                                                        </div>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </li> -->
                                    <li class="has-children">
                                        <a href="/shop"><i class="evara-font-tshirt"></i>Men's Clothing</a>

                                    </li>
                                    </li>



                                </ul>

                            </div>
                        </div>
                        <div class="main-menu main-menu-padding-1 main-menu-lh-2 d-none d-lg-block">
                            <nav>
                                <ul>
                                    <li><a class="active" href="/home">Home </i></a>

                                    </li>

                                    <li><a href="/shop">Shop </i></a>

                                    </li>

                                    <!-- <li><a href="blog-category-grid.html">Blog </i></a> -->

                                    </li>
                                    <li><a href="#">Pages <i class="fi-rs-angle-down"></i></a>
                                        <ul class="sub-menu">
                                            <li><a href="/contact">About Us</a></li>
                                            <li><a href="/contact">Contact</a></li>
                                            <li><a href="/profile">My Account</a></li>
                                            <!-- <li><a href="login">login/register</a></li>
                                            <li><a href="#">Privacy Policy</a></li>
                                            <li><a href="#">Terms of Service</a></li> -->
                                        </ul>
                                    </li>
                                    <li>
                                        <a href="/contact">Contact</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>

                    <div class="header-action-right d-block d-lg-none">
                        <div class="header-action-2">
                            <div class="header-action-icon-2">
                                <a href="#">
                                    <img alt="Evara" src="/Userassets/imgs/theme/icons/icon-heart.svg">
                                    <span class="pro-count white">4</span>
                                </a>
                            </div>
                            <div class="header-action-icon-2">
                                <a class="mini-cart-icon" href="#">
                                    <img alt="Evara" src="/Userassets/imgs/theme/icons/icon-cart.svg">
                                    <span class="pro-count white">2</span>
                                </a>
                                <div class="cart-dropdown-wrap cart-dropdown-hm2">
                                    <ul>
                                        <li>
                                            <div class="shopping-cart-img">
                                                <a href="#"><img alt="Evara"
                                                        src="/Userassets/imgs/shop/thumbnail-3.jpg"></a>
                                            </div>
                                            <div class="shopping-cart-title">
                                                <h4><a href="#">Plain Striola Shirts</a></h4>
                                                <h3><span>1 × </span>$800.00</h3>
                                            </div>
                                            <div class="shopping-cart-delete">
                                                <a href="#"><i class="fi-rs-cross-small"></i></a>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="shopping-cart-img">
                                                <a href="#"><img alt="Evara"
                                                        src="/Userassets/imgs/shop/thumbnail-4.jpg"></a>
                                            </div>
                                            <div class="shopping-cart-title">
                                                <h4><a href="shop-product-right.html">Macbook Pro 2022</a></h4>
                                                <h3><span>1 × </span>3500.00</h3>
                                            </div>
                                            <div class="shopping-cart-delete">
                                                <a href="#"><i class="fi-rs-cross-small"></i></a>
                                            </div>
                                        </li>
                                    </ul>
                                    <div class="shopping-cart-footer">
                                        <div class="shopping-cart-total">
                                            <h4>Total <span>$383.00</span></h4>
                                        </div>
                                        <div class="shopping-cart-button">
                                            <a href="#">View cart</a>
                                            <a href="#">Checkout</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="header-action-icon-2 d-block d-lg-none">
                                <div class="burger-icon burger-icon-white">
                                    <span class="burger-icon-top"></span>
                                    <span class="burger-icon-mid"></span>
                                    <span class="burger-icon-bottom"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <style>
        .coupon-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            margin-right: 10px;
            margin-top: 10px;
        }

        .coupon-details {
            flex-grow: 1;
        }

        .apply-btn {
            background-color: #4caf50;
            color: white;
            border: none;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }

        a.btn.disabled {
            pointer-events: none;
            /* Prevents clickable events */
            color: #ccc;
            /* Makes the text color light grey */
        }

        .disabled-link {
            pointer-events: none;
            /* Disable pointer events to prevent interactions */
            color: #999;
            /* Change the color to a muted or grayed-out style */
            text-decoration: none;
            /* Remove underlines or other text decorations */
        }

        a.disabled {
            pointer-events: none;
            cursor: default;
            color: #ccc;
        }

        .alert {
            padding: 10px;
            background-color: #f44336;
            color: white;
            text-align: center;
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 20vw;
            z-index: 1000;
        }

        #stockAlert {
            position: fixed;
            top: 20%;
            /* Center the alert vertically */
            left: 50%;
            /* Center the alert horizontally */
            transform: translate(-50%, -50%);
            /* Center the alert perfectly */
            padding: 10px;
            background-color: #f44336;
            color: white;
            text-align: center;
        }
    </style>


    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="index.html" rel="nofollow">Home</a>
                    <span></span> Shop
                    <span></span> Your Cart
                </div>
            </div>
        </div>
        <section class="mt-0 mb-50">
            <div class="container p-5" id="alert-box">
                <!-- ALert boxx -->
            </div>
            <% if (cart && cart.items.length>0) { %>
            <div class="container">
                <div class="row">

                    <div class="col-12">
                        <div class="table-responsive">
                            <table class="table shopping-summery text-center clean">
                                <thead>
                                    <tr class="main-heading">
                                        <th scope="col">Image</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Price</th>
                                        <th scope="col">Quantity</th>
                                        <th scope="col">Remove</th>
                                    </tr>
                                </thead>
                                <tbody>


                                    <% for (let i=0; i < cart.items.length; i++) { %>
                                    <tr>
                                        

                                        <td class="image product-thcartumbnail"><img src="<%= cart.items[i].image  %>"
                                                alt="Product Image">
                                        </td>
                                        <td class="product-des product-name">
                                            <h5 class="product-name"><a
                                                    href="/product-detail/<%= cart.items[i].productId %>">
                                                    <%= cart.items[i].data.name %>
                                                </a></h5>

                                        </td>
                                        <td class="price" data-title="Price" id="totalPrice"><span>₹ <%=
                                                                cart.items[i].data.price %> </span></td>
                                        <td class="text-center" data-title="Stock">
                                            <div class="detail-qty border radius  m-auto">
                                                <% if(cart.items[i].quantity> 1) { %>
                                                <a href="#" class="qty-down"
                                                    data-id="<%= cart.items[i].productId  %>"><i
                                                        class="fi-rs-angle-small-down"></i></a>
                                                <% } %>
                                                <span class="qty-val" id="qty-<%= cart.items[i].productId  %>">
                                                    <%= cart.items[i].quantity %>
                                                </span>
                                                <% if (cart.items[i].data.stock >=
                                                                        cart.items[i].quantity) { %>
                                                <a href="#" class="qty-up" data-id="<%= cart.items[i].productId  %>"><i
                                                        class="fi-rs-angle-small-up"></i></a>
                                                <% } else { %>

                                                <% }%>
                                            </div>
                                        </td>
                                        
                                        <td class="action" data-title="Remove"><button type="button"
                                                onclick="removeItem('<%= cart.items[i].productId %>')"
                                                class="text-muted"><i class="fi-rs-trash"></i></button>
                                        </td>
                                    </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                        <div class="cart-action text-end">

                            <a class="btn " href="/shop"><i class="fi-rs-shopping-bag mr-10"></i>Continue
                                Shopping</a>
                        </div>
                        <div class="divider center_icon mt-50 mb-50"><i class="fi-rs-fingerprint"></i></div>
                        <div class="row mb-50">
                            <div class="row">
                                <div class="col-lg-12 col-md-12">
                                    <div class="card mb-3">
                                        <div class="card mb-3">


                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-12 col-md-12">
                                    <div>
                                         <a href="/cart/check-verify" class="btn btn-primary cart-btn-transform m-3"
                                        data-abc="true"  onclick="checkout()">checkout</a>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            </div>
            <% } else{%>
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5>Cart</h5>
                            </div>
                            <div class="card-body cart">
                                <div class="col-sm-12 empty-cart-cls text-center">
                                    <img src="https://i.imgur.com/dCdflKN.png" width="130" height="130"
                                        class="img-fluid mb-4 mr-3">
                                    <h3><strong>Your Cart is Empty</strong></h3>
                                    <h4>Add something to make me happy :</h4>
                                    <a href="/shop" class="btn btn-primary cart-btn-transform m-3"
                                        data-abc="true">continue
                                        shopping</a>


                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <% } %>
        </section>
    </main>


    <!-- Preloader Start -->

    <script>
        function removeItem(productId) {

            fetch('/cart/remove-product/' + productId, {
                    method: 'DELETE',
                })
                .then((res) => res.json())
                .then((data) => {
                    const alertBox = document.getElementById('alert-box');
                    let alertHTML = '';

                    if (data.success) {
                        updateBillTotal();
                        // Success message with SweetAlert
                        Swal.fire({
                            icon: 'success',
                            title: 'Success',
                            text: data.message,
                            onClose: () => {
                                window.location.reload();
                            },
                        });
                    } else {
                        // Error message with SweetAlert
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: data.message,
                        });
                    }
                })
                .catch((err) => {
                    console.log(err);
                });
        }



        //Function to Update Quanity of 


        const updateQuantity = (productId, newQuantity) => {
            fetch('/cart/update-cart-quantity/' + productId, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        quantity: newQuantity,
                    }),
                }).then((res) => res.json())
                .then((data) => {
                    if (data.success) {
                        updateBillTotal();
                    } else {
                        console.log(data.message)
                    }
                })
                .catch((err) => {
                    console.log(err)
                })
        }

        //
        const qtyUpButtons = document.querySelectorAll('.qty-up');
        const qtyDownButtons = document.querySelectorAll('.qty-down');

        //Increase Quanity
        qtyUpButtons.forEach((button) => {
            button.addEventListener('click', () => {
                const productId = button.getAttribute('data-id');
                const qtyElement = document.getElementById(`qty-${productId}`);

                const currentQty = parseInt(qtyElement.textContent);
                const newQty = currentQty + 1;
                qtyElement.textContent = newQty;
                updateQuantity(productId, newQty);

            })
        })

        //Decrease Quantity
        qtyDownButtons.forEach((button) => {
            button.addEventListener('click', () => {
                const productId = button.getAttribute('data-id');
                const qtyElement = document.getElementById(`qty-${productId}`);

                const currentQty = parseInt(qtyElement.textContent);
                if (currentQty > 1) {
                    const newQty = currentQty - 1;
                    qtyElement.textContent = newQty;
                    updateQuantity(productId, newQty);
                }
            });
        });



        function updateBillTotal() {
            const selectedProductIds = Array.from(document.querySelectorAll('.product-checkbox:checked')).map(
                checkbox =>
                checkbox.getAttribute('data-id'));
       
            fetch('/cart/update-cart-total', {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        selectedProductIds
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Handle the response from the server, which may include the updated billTotal.
                        console.log(data); // Log the response for testing purposes
                        window.location.reload();
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: data.message
                        });
                        console.log(data.message)
                    }
                })
                .catch(error => {
                    // Handle errors if the request fails
                    console.error('Error:', error);
                });
        }


        function checkout() {
    const selectedItems = [];

    // Select all checkboxes with the class 'checkout-checkbox'
    const checkboxes = document.querySelectorAll('.checkout-checkbox:checked');

    checkboxes.forEach((checkbox) => {
        const productId = checkbox.getAttribute('data-id');
        const productName = checkbox.getAttribute('data-name');
        const productPrice = checkbox.getAttribute('data-price');
        const productQuantity = checkbox.getAttribute('data-quantity');

        selectedItems.push({
            productId,
            productName,
            productPrice,
            productQuantity,
        });
    });

    // Send the selected products to the server using AJAX (Assuming you are using jQuery for simplicity)
    $.ajax({
        type: 'POST',
        url: '/cart/checkout', // Replace with your server endpoint
        data: { selectedItems: JSON.stringify(selectedItems) },
        success: function (response) {
            // Handle the response from the server, e.g., redirect to the checkout page
            window.location.href = '/checkout-page';
        },
        error: function (error) {
            console.error('Error during checkout:', error);
        },
    });
}

    </script>

</html>